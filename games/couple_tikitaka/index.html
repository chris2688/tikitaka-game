
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport"/>
<title>너와 나의 TIKI TAKA</title>
<link href="assets/favicon.ico" rel="icon" type="image/x-icon"/>
<style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: url('assets/background.jpg') center/cover no-repeat;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      text-align: center;
      color: white;
    }
    h1 {
  font-size: clamp(32px, 5vw, 64px);
  margin-bottom: 60px;
}
    #startText {
   font-size: 20px;
  font-weight: 600;
  margin-bottom: 20px;
  padding: 16px 24px;
  background-color: rgba(0, 0, 0, 0.5);
  color: white;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  max-width: 90%;
  word-break: keep-all;
  white-space: normal;
  line-height: 1.8;
  display: inline-block;
}
    #nameForm, #startPrompt, #questionBox, #finalResult {
      display: none;
    }
.button {
  background-color: #88f5e1;
  color: black;
  border: none;
  padding: 12px 24px;
  font-size: 16px; /* ✅ 16px 이상: 모바일 줌 방지 */
  border-radius: 6px;
  cursor: pointer;
  margin: 6px 10px;
  word-break: keep-all;
  white-space: nowrap;
  min-width: 120px;
  max-width: 200px;

  /* ✅ 모바일 터치 최적화 */
  touch-action: manipulation;
  -webkit-text-size-adjust: 100%;
}
input {
  padding: 12px;
  font-size: 16px; /* ✅ 16px 이상으로 유지 (줌 방지용) */
  margin: 10px;
  border-radius: 6px;
  border: none;
  width: 180px;
  box-sizing: border-box;

  /* ✅ 모바일 줌 방지 */
  touch-action: manipulation;
  -webkit-text-size-adjust: 100%;
}
    #question {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #result {
      font-size: 32px;
      font-weight: bold;
    }
.result-box h2,
.result-box p {
  word-break: keep-all;     /* 단어 단위 줄바꿈 */
  white-space: normal;      /* 강제 줄바꿈 가능하게 */
  text-align: center;
  line-height: 1.6;
  font-size: clamp(18px, 4vw, 24px); /* PC에서도 과도하게 커지지 않도록 */
}
.result-box {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
    
.small-btn {
  padding: 8px 16px;
  font-size: 14px;
  min-width: 100px;
  max-width: 140px;
}

.question-box {
  position: relative;
  background-color: rgba(255, 255, 255, 0.85);
  border-radius: 16px;
  padding: 24px 16px;
  color: #111;
  width: 100%;
  max-width: 960px; 
  margin: 0 auto 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  min-height: 140px;
  line-height: 1.6;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

/* 질문 박스 안, 우측 상단 라운드 배지 */
.round-indicator {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba(0, 60, 80, 0.85);
  color: #fff;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
  z-index: 1;
}

    
.icon-button {
  margin: 0 4px;
  padding: 4px;
  background-color: transparent;
  border: none;
  box-shadow: none;
}

.icon-button:hover {
  background-color: rgba(255,255,255,0.2);
  border-radius: 10px;
}

.icon-button img {
  display: block;
  margin: 0 auto;
  height: 24px;
  width: auto;
  max-width: 24px;
  max-height: 24px;
}
    
#background {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  background: url('assets/background.jpg') center/cover no-repeat;
  z-index: -1;

  /* 💡 줌 방지와 렌더링 안정화 */
  will-change: transform;
  backface-visibility: hidden;
  -webkit-transform: translateZ(0); /* Safari 보완 */
  transform: scale(1) !important;   /* ✅ 줌 초기화 강제 적용 */
}

#progressBarContainer {
  width: 100%;
  max-width: 640px;
  height: 10px;
  background-color: rgba(255, 255, 255, 0.3);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 16px;
}

#progressBar {
  height: 100%;
  width: 0%;
  background-color: #88f5e1;
  transition: width 0.3s ease;
}

input,
button,
textarea {
  font-size: 16px; /* 절대 16px 이상 */
  touch-action: manipulation;
  -webkit-text-size-adjust: 100%; /* iOS 대응 */
}


html, body {
  overscroll-behavior: none;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  font-size: 16px;
}

input, button, textarea {
  font-size: 16px !important;
  -webkit-text-size-adjust: 100%;
  touch-action: manipulation;
}

body {
  transform: scale(1) !important;
  transform-origin: top left;
}

@media (max-width: 480px) {
  .question-box p {
    font-size: clamp(24px, 7vw, 36px);
  }
}

@media (min-width: 768px) {
  .question-box {
    max-width: 640px;
    padding: 24px 32px; /* ← 여백 조절 */
  }
}

@media (max-width: 480px) {
  .question-summary {
    font-size: 15px;
    padding: 16px;
  }
}

@media (min-width: 768px) {
  .question-summary-box {
    max-width: 640px;
  }
}
@media (max-width: 480px) {
  .icon-button img {
    height: 20px;
    max-height: 20px;
  }
}
@media (max-width: 480px) {
  .icon-button-wrapper {
    margin-right: -20px !important;
  }
}
    
#customPopup {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

#popupBox {
  background-color: white;
  padding: 24px 32px;
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  text-align: center;
  max-width: 90%;
  font-size: 18px;
  color: #333;
}

#popupBox button {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 16px;
  background-color: #88f5e1;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.result-box {
  background-color: rgba(255,255,255,0.7);
  padding: 24px 20px;
  border-radius: 16px;
  margin: 0 auto;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  width: 90%;
  max-width: 100%;
  box-sizing: border-box;
}

@media (min-width: 768px) {
  .result-box {
    max-width: 640px; /* PC에서 넓이 제한 */
    padding: 32px;     /* 여백 조금 더 주기 */
  }
}

.share-button:hover {
  background-color: #66e0cb;
}

.share-button {
  padding: 10px 16px; /* 좀 더 여유롭게 */
  font-size: 16px;
}
    
  </style>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<body>
<div id="background"></div>
<h1>너와 나의 TIKI TAKA</h1>
<div id="nameForm">
<input id="player1Name" placeholder="당신의 이름"/>
<input id="player2Name" placeholder="옆사람의 이름"/>
<button class="button" onclick="saveNames()">입력 완료</button>
</div>
<div id="startPrompt">
<p id="startText"></p>
<button class="button" id="startGameBtn" onclick="startGame()">나 먼저 시작할게!</button>
</div>
<div id="questionBox">
<div id="progressBarContainer">
<div id="progressBar"></div>
</div>
<div id="question"></div>
<button class="button choice-button" id="btn1" onclick="">선택 1</button>
<button class="button choice-button" id="btn2" onclick="">선택 2</button>
<div id="result"></div>
</div>
<div id="finalResult"></div>
<div id="customPopup" style="display: none;">
<div id="popupBox">
<p id="popupMessage">질문답변도 함께 저장할까요?</p>
<div style="margin-top: 20px;">
<button onclick="downloadAnswers()" style="margin-right: 10px;">예</button>
<button onclick="closePopup()">아니오</button>
</div>
</div>
</div>
<script>
     const baseQuestions = [
    "먼저 사과하는 사람은?",
    "데이트 장소를 더<br>자주 정하는 사람은?",
    "연락을 더 자주 하는 사람은?",
    "더 질투가 많은 사람은?",
    "잠들기 전에 마지막으로<br>메시지 보내는 사람은?",
    "영화를 볼 때 더 먼저 <br>울컥하는 사람은?",
    "더 오래 연락이 안 되면 <br>서운해하는 사람은?",
    "더 자주 웃게 <br>만들어주는 사람은?",
    "함께 있을 때 더 <br>편안함을 느끼는 사람은?",
    "먼저 '사랑해'라고 <br>말하는 사람은?"
  ];

  const extraQuestions = [
    "누가 더 신중하게 쇼핑을 하나요?",
    "누가 더 즉흥적으로 계획을 세우나요?",
    "함께 있을 때 누가 더<br>웃음을 잘 이끌어 내나요?",
    "누가 가장 먼저 감정 표현을 하나요?",
    "누가 더 늦잠을 자나요?",
    "누가 더 음식을 빨리 먹나요?",
    "함께 요리할 때 누가<br>더 섬세하게 맛을 조절하나요?",
    "누가 더 다정한 포옹을 하나요?",
    "영화 고를 때 누가 더<br>취향이 까다로운가요?",
    "누가 더 자주 휴대폰을 확인하나요?",
    "함께 있을 때 누가 더<br>휴식을 취하나요?",
    "누가 더 야심 찬 꿈을 꿔왔나요?",
    "누가 더 자주 웃음을 터트리나요?",
    "어려울 때 누가 더 먼저 도와주나요?",
    "첫만남 때 누가 더<br>긴장했을까요?",
    "누가 더 깜짝 선물을 좋아하나요?",
    "누가 더 로맨틱한 분위기를<br>만들어 내나요?",
    "함께 걸을 때 누가 더 빨리 걷나요?",
    "누가 더 스포츠에<br>열정적인가요?",
    "누가 더 노래방에서 열창하나요?",
    "누가 더 춤을 잘 추나요?",
    "함께 놀러 갈 때 누가<br>더 계획적인가요?",
    "누가 더 모험을 좋아하나요?",
    "누가 더 책을 많이 읽어 왔나요?",
    "누가 더 혼자만의 시간을<br>중요하게 여길까요?",
    "누가 더 새벽 감성을<br>즐겨하나요?",
    "함께 스파에 간다면 누가<br>더 피곤해 보일까요?",
    "누가 더 혼자 영화를<br>즐기고 싶어하나요?",
    "누가 더 카페에서 시간을<br>보내는 걸 좋아하나요?",
    "누가 더 콘서트 티켓을<br>사려고 줄을 설까요?",
    "함께 사진 찍을 때 누가<br>더 포즈를 잘 취하나요?",
    "누가 더 사진을 잘 찍나요?",
    "누가 더 미술관을<br>좋아하나요?",
    "누가 더 박물관을 좋아하나요?",
    "함께 드라이브 가면 누가<br>더 운전하기를 선호하나요?",
    "누가 더 별보는 걸<br>좋아하나요?",
    "밤하늘을 볼 때 누가 더<br>감성적일까요?",
    "함께 캠핑 가면 누가<br>텐트를 잘 칠까요?",
    "누가 더 어색한 침묵을<br>잘 견디나요?",
    "누가 더 감동적인 편지를<br>잘 쓰나요?",
    "누가 더 손편지를<br>전달하고 싶어하나요?",
    "함께 운동하면 누가<br>더 열심히 하나요?",
    "누가 더 강한 의지를<br>가지고 있나요?",
    "누가 더 어릴 적 꿈을<br>잘 이야기하나요?",
    "누가 더 예전 사진을<br>자주 꺼내 보나요?",
    "누가 더 향수나<br>향기 있는 걸 좋아하나요?",
    "함께 장볼 때 누가<br>더 꼼꼼히 장바구니를 채우나요?",
    "누가 더 영화 예고편만 봐도<br>재밌을 것 같나요?",
    "누가 더 감성적인<br>음악을 좋아하나요?",
    "함께 춤추면 누가 더<br>리듬을 잘 탈까요?",
    "누가 더 친구들에게 연락을<br>자주 하나요?",
    "누가 더 낯선 사람에게<br>다가가기 어려워하나요?",
    "함께 사진을 보면 누가 더<br>추억을 잘 떠올리나요?",
    "누가 더 맛집 추천을<br>잘 하나요?",
    "누가 더 사진 속 배경을<br>고려하나요?",
    "스마트폰 배터리가 적을 때<br>누가 먼저 충전기를 찾을까요?",
    "함께 텐트를 접을 때 누가<br>더 능숙할까요?",
    "가장 힘들었던 순간을<br>함께 나누고 싶나요?",
    "누가 더 작은 선물에도<br>감동을 많이 받을까요?",
    "누가 더 깜짝 이벤트를<br>계획하나요?",
    "함께 페인팅하면 누가<br>더 창의적일까요?",
    "누가 더 새로운 취미를<br>시도하는 편인가요?",
    "함께 게임할 때 누가<br>더 승부욕이 강할까요?",
    "누가 더 비 오는 날을<br>즐기는 편인가요?",
    "함께 눈 오는 날을<br>기다리고 싶나요?",
    "누가 더 커피를 진하게<br>선호하나요?",
    "함께 차 마실 때 누가<br>더 감미롭게 분위기를 즐기나요?",
    "누가 더 밤늦게까지<br>영화를 볼까요?",
    "함께 별빛 아래 누가<br>더 시를 읊어볼까요?",
    "누가 더 눈부신<br>아침 햇살을 좋아하나요?",
    "함께 바닷가 산책 시 누가<br>더 모래를 만지고 싶어하나요?",
    "누가 더 구름 모양을 보고<br>상상하기를 좋아하나요?",
    "함께 음악 페스티벌 가면 누가<br>더 소리를 지를까요?",
    "누가 더 사람이 많은 곳을<br>즐겨하나요?",
    "함께 텔레파시가 통할 것 같은<br>순간이 있었나요?",
    "누가 더 상대방의 작은 변화를<br>잘 알아채나요?",
    "함께 독서하면 누가<br>더 집중하는 편인가요?",
    "누가 더 밤하늘에 소원을<br>빌고 싶어하나요?",
    "함께 춤추며 누가<br>더 즉흥적으로 리듬을 탈까요?",
    "누가 더 함께 늙어가는<br>상상을 하나요?"
  ];
   const questions = [...baseQuestions, ...extraQuestions];
  const totalQuestions = questions.length;

    const endings = [
      "우리의 티키타카 멋졌어요!<br>찰떡궁합 커플이네요!",
      "이 정도면 운명 아닐까요? 💘",
      "두 분,<br>티키타카 챔피언입니다!",
      "완벽 그 자체!",
      "이런 공감, 흔치 않아요~!"
    ];
    
    const questionsPerRound   = 5;   // 라운드 당 문항 수
    let currentRound          = 0;   // 지금까지 진행된 라운드 수
    let totalQuestionsAsked   = 0;   // 지금까지 물어본 총 문항 수

 let p1 = "", p2 = "";
let isFirst = true, index = 0;
let firstAnswers = [], secondAnswers = [], score = 0;
let selectedQuestions = [];

     document.addEventListener("DOMContentLoaded", function () {

    document.getElementById("player1Name").value = "";
    document.getElementById("player2Name").value = "";

    document.getElementById("nameForm").style.display = "none";
    document.getElementById("startPrompt").style.display = "none";
    document.getElementById("questionBox").style.display = "none";
    document.getElementById("finalResult").style.display = "none";

    document.getElementById("nameForm").style.display = "block";
  });

    function saveNames() {
      p1 = document.getElementById("player1Name").value;
      p2 = document.getElementById("player2Name").value;
      if (!p1 || !p2) return showAlertPopup("이름을 모두 입력해주세요!");
      document.getElementById("nameForm").style.display = "none";
      document.getElementById("startPrompt").style.display = "block";
      document.getElementById("startText").innerHTML = 
  `<span style="color:#88f5e1; font-weight:bold;">${p1}</span>님부터 <strong>TIKI</strong>를 시작해보세요.`;
    }


function startExtraRound() {
  // 남은 질문 계산
  const remaining = questions.filter(q => !selectedQuestions.includes(q));
  if (remaining.length === 0) {
    showAlertPopup("더 이상 질문이 없습니다!");
    return;
  }

  // 라운드 수 증가 및 누적 질문 수 갱신
  currentRound++;
  const nextSet = remaining
    .sort(() => Math.random() - 0.5)
    .slice(0, questionsPerRound);
  selectedQuestions.push(...nextSet);
  totalQuestionsAsked += nextSet.length;

  // 상태 초기화
  isFirst = true;
  index = 0;

  // UI 전환: 결과 숨기고, 다시 시작 프롬프트로
  document.getElementById("finalResult").style.display = "none";
  document.getElementById("startPrompt").style.display = "block";
  document.getElementById("startText").innerHTML =
    `<span style="color:#88f5e1; font-weight:bold;">${p1}</span>님, 다시 TIKI부터 시작!`;

  // 이전 버튼 제거
  const oldStartBtn = document.getElementById("startGameBtn");
  if (oldStartBtn) oldStartBtn.remove();
  const oldTakabBtn = document.getElementById("beginTAKABtn");
  if (oldTakabBtn) oldTakabBtn.remove();

  // 새 시작 버튼 생성
  const newBtn = document.createElement("button");
  newBtn.className = "button";
  newBtn.id = "startGameBtn";
  newBtn.innerText = "나 먼저 시작할게!";
  newBtn.onclick = () => {
    document.getElementById("startPrompt").style.display = "none";
    document.getElementById("questionBox").style.display = "block";
    showQuestion();
    document.getElementById('btn1').disabled = false;
    document.getElementById('btn2').disabled = false;
  };
  document.getElementById("startPrompt").appendChild(newBtn);
}


       
       
function captureResult() {
  alert("공유하기 기능은 준비 중입니다!");
}
    
function startGame() {
  // 1라운드 시작
  currentRound = 1;
  totalQuestionsAsked = questionsPerRound;

  // 1라운드 질문 뽑기
  selectedQuestions = questions
    .sort(() => Math.random() - 0.5)
    .slice(0, questionsPerRound);

  // UI 전환
  document.getElementById("startPrompt").style.display = "none";
  document.getElementById("questionBox").style.display = "block";
  showQuestion();
  document.getElementById('btn1').disabled = false;
  document.getElementById('btn2').disabled = false;
}
    
function showQuestion() {
  const questionEl = document.getElementById("question");
  questionEl.className = "question-box";

    // ───── 라운드별 시작 오프셋 계산 ─────
  const phaseLabel = isFirst ? "TIKI 질문" : "TAKA 질문";
  const baseIndex = (currentRound - 1) * questionsPerRound;


  // 우측 상단에 라운드 배지
  questionEl.innerHTML = `
    <span class="round-indicator">
      ${currentRound}라운드
    </span>

    <h2 style="margin:0; font-size:18px; color:#003344;">
      ${phaseLabel} <span style="font-size:14px; color:#666;">
        (${index+1}/${questionsPerRound})
     </span>
    </h2>
    <p style="
      font-size:clamp(28px,6.5vw,42px);
      font-weight:bold;
      margin:8px 0;
      text-align:center;
      padding:0 8px;
    ">
      ${selectedQuestions[baseIndex + index]}
    </p>
  `;
 
    

  // ───── 진행률도 누적 기준 totalQuestionsAsked 으로 계산 ─────
  const progressPercent = Math.round(
    ((baseIndex + index + (isFirst ? 0 : questionsPerRound)) 
      / totalQuestionsAsked) * 100
  );


  document.getElementById("progressBar").style.width = `${progressPercent}%`;

  document.getElementById("result").innerText = "";

  const btn1 = document.getElementById("btn1");
  const btn2 = document.getElementById("btn2");

  btn1.innerText = p1;
  btn2.innerText = p2;
  btn1.onclick = () => choose(p1);
  btn2.onclick = () => choose(p2);
}

   function choose(choice) {
  const btn1 = document.getElementById("btn1");
  const btn2 = document.getElementById("btn2");

  // 🔒 클릭 후 버튼 잠금
  btn1.disabled = true;
  btn2.disabled = true;

  if (isFirst) {
    firstAnswers.push(choice);
    index++;
    if (index < 5) {
      showQuestion();
    document.getElementById('btn1').disabled = false;
    document.getElementById('btn2').disabled = false;
      // 🔓 다시 활성화
      btn1.disabled = false;
      btn2.disabled = false;
} else {
  isFirst = false;
  index = 0;

  // 질문 영역 숨기고, 시작 프롬프트 보여주기
  document.getElementById("questionBox").style.display = "none";
  document.getElementById("startPrompt").style.display = "block";

  // 메시지 변경
  document.getElementById("startText").innerHTML =
    `이젠 <span style="color:#ffde74; font-weight:bold;">${p2}</span>님 차례예요.<br>서로의 마음을 맞춰봐요.`;

  // ✅ 기존 버튼 제거 (id가 붙은 버튼만 정확히 제거)
  const oldStartBtn = document.getElementById("startGameBtn");
  if (oldStartBtn) oldStartBtn.remove();

  const oldTakabBtn = document.getElementById("beginTAKABtn");
  if (oldTakabBtn) oldTakabBtn.remove();

  // ✅ 새로운 버튼 생성
  const btn = document.createElement("button");
  btn.innerText = "이젠 내가 TAKA 해 볼게!";
  btn.className = "button";
  btn.id = "beginTAKABtn";

  btn.onclick = () => {
    document.getElementById("startPrompt").style.display = "none";
    document.getElementById("questionBox").style.display = "block";

    showQuestion();
    document.getElementById('btn1').disabled = false;
    document.getElementById('btn2').disabled = false;

    // ❗ 선택 버튼 재활성화
    document.getElementById("btn1").disabled = false;
    document.getElementById("btn2").disabled = false;
  };

  document.getElementById("startPrompt").appendChild(btn);
}
  } else {

    secondAnswers.push(choice);
    const globalIndex = (currentRound - 1) * questionsPerRound + index;
    const match = choice === firstAnswers[globalIndex];
    if (match) score++;

    const resultBox = document.getElementById("result");
resultBox.innerHTML = `
  <div style="
    display: inline-block;
    background-color: ${match ? 'rgba(136, 245, 225, 0.85)' : 'rgba(255, 120, 120, 0.85)'};
    border: 2px solid white;
    border-radius: 12px;
    padding: 12px 20px;
    font-size: 24px;
    font-weight: bold;
    color: ${match ? '#003344' : '#400000'};
    margin-top: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  ">
    ${match ? "⭕ 티키타카!" : "❌ 티키타카"}
  </div>
`;
    index++;
    if (index < 5) {
      setTimeout(() => {
        showQuestion();
    document.getElementById('btn1').disabled = false;
    document.getElementById('btn2').disabled = false;
        document.getElementById('btn1').disabled = false;
        document.getElementById('btn2').disabled = false;
        // 🔓 다음 질문 나오면 버튼 다시 활성화
        btn1.disabled = false;
        btn2.disabled = false;
      }, 1500); // 1.5초 대기
    } else {
      setTimeout(() => {
document.getElementById("questionBox").style.display = "none";
const ending = endings[Math.floor(Math.random() * endings.length)];
  // ▶ 1~N라운드 누적 문항 수(totalQuestionsAsked)를 분모로 사용
  const total = totalQuestionsAsked;  
  const percentage = total > 0
    ? Math.round((score / total) * 100)
    : 0;  // 문항이 없으면 0%

let answerListHTML = "<ul style='list-style:none; padding:0; text-align:left;'>";

for (let i = 0; i < total; i++) {
  const questionText = selectedQuestions[i].replace(/<br>/g, ' ');
  const match = firstAnswers[i] === secondAnswers[i];
  const icon = match ? "⭕" : "❌";

answerListHTML += `
  <li style="margin-bottom: 20px;">
    <div style="line-height: 1.6; font-size: 16px;">
      <strong>Q${i + 1}.</strong> ${questionText}
    </div>
    <div style="margin-top: 4px;">· ${p1}: ${firstAnswers[i]}</div>
    <div style="margin-top: 4px;">· ${p2}: ${secondAnswers[i]}</div>
    <div style="margin-top: 4px;">
      · 결과: 
      <span style="color: #e53935; font-weight: bold;">${icon}</span>
      ${
        match
          ? '<span style="color: #00bfa5; font-weight: bold;"> TIKI TAKA</span>'
          : '<span style="color: #000; font-weight: bold;"> 불일치</span>'
      }
    </div>
  </li>
`;
}
answerListHTML += "</ul>";

document.getElementById("finalResult").innerHTML = `
<div class="result-box" id="resultSummaryBox">
    <h2 style="font-size: 28px; color: #000; line-height: 1.6;">
      ${p1} ❤️${p2}<br>TIKI TAKA 결과
    </h2>
    <p style="margin-top: 10px; font-size: 20px; color: #000;">
      총 ${total}문제 중 <strong>${score}개</strong> 일치<br>
      티키타카 성공률:
      <span style="
        display: inline-block;
        font-size: 42px;
        font-weight: 900;
        color: #00bfa5;
        text-shadow:
          -1px -1px 0 #ffffff,
           1px -1px 0 #ffffff,
          -1px  1px 0 #ffffff,
           1px  1px 0 #ffffff;">
        ${percentage}%
      </span>
    </p>

    <p style="
  font-size: clamp(18px, 4vw, 24px);
  font-weight: bold;
  color: #222;
  line-height: 1.6;
  margin-top: 20px;
  word-break: keep-all;
  white-space: normal;
  text-align: center;
">
      ${ending}
    </p>

<div style="margin-top: 40px; display: flex; justify-content: center; gap: 8px; flex-wrap: nowrap; flex-direction: row;">
  <button class="button small-btn icon-button" onclick="resetGame()" aria-label="다시하기">
    <img src="assets/icon_1.png" alt="다시하기" style="height: 24px;">
  </button>
  <button class="button small-btn icon-button" onclick="startExtraRound()" aria-label="계속하기">
    <img src="assets/icon_2.png" alt="계속하기" style="height: 24px;">
  </button>
  <button class="button small-btn icon-button" onclick="captureResult()" aria-label="공유하기">
    <img src="assets/icon_3.png" alt="공유하기" style="height: 24px;">
  </button>
</div>
  </div>

  <!-- ✅ 질문 정리 박스 분리 -->
<div style="
  margin: 32px auto 0;
  padding: 24px 20px; /* 결과 박스와 동일한 padding */
  background-color: rgba(255,255,255,1);
  border-radius: 16px; /* 결과 박스와 동일한 radius */
  color: #111;
  text-align: left;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* 결과 박스와 동일한 그림자 */
  font-size: 16px;
  width: 90%;
  max-width: 100%;  /* 결과 박스와 동일 */
  box-sizing: border-box; /* 결과 박스와 동일 */
">
   <div id="answerSummaryBox" style="padding: 24px 20px; background: white; border-radius: 16px;">
    <h3 style="color: #000; font-size: 20px; margin-bottom: 16px;">📋 질문 & 답변 정리</h3>
    ${answerListHTML}
  </div>
  </div>
`; 
document.getElementById("finalResult").style.display = "block";
      }, 1500); // ← 여유 시간 주고 결과창 띄우기
    }
  }
 }
     function showPopup(message) {
  document.getElementById("popupMessage").innerText = message;
  document.getElementById("customPopup").style.display = "flex";
}


    
function closePopup() {
  document.getElementById("customPopup").style.display = "none";
}


function captureAnswers() {
  const target = document.getElementById("answerSummaryBox");
  html2canvas(target, {
    scrollY: -window.scrollY
  }).then(canvas => {
    const link = document.createElement('a');
    link.download = '티키타카_답변정리.png';
    link.href = canvas.toDataURL();
    link.click();
  });
}

function captureResult() {
  const resultTarget = document.querySelector('.result-box');

  html2canvas(resultTarget, {
    backgroundColor: null,
    scrollY: -window.scrollY
  }).then(canvas1 => {
    const link1 = document.createElement('a');
    link1.download = '티키타카_결과.png';
    link1.href = canvas1.toDataURL();
    link1.click();

    // 결과 저장 후 질문답변도 함께 저장할지 묻는 팝업 띄우기
    document.getElementById("popupMessage").innerText = "질문답변도 함께 저장할까요?";
    document.getElementById("customPopup").style.display = "flex";
  });
}

    
function downloadAnswers() {
  const answerTarget = document.getElementById('answerSummaryBox');

  html2canvas(answerTarget, {
    backgroundColor: null,
    scrollY: -window.scrollY
  }).then(canvas => {
    const link = document.createElement('a');
    link.download = '티키타카_답변정리.png';
    link.href = canvas.toDataURL();
    link.click();

    
    closePopup();
  });
}
function closePopup() {
  document.getElementById("customPopup").style.display = "none";
}
document.addEventListener("keydown", function (e) {
  if (e.key === "Escape") {
    closeAlertPopup(); // 확인용 팝업 닫기
    closePopup();      // 예/아니요 팝업 닫기
  }
});
    
document.addEventListener("DOMContentLoaded", function () {
  document.getElementById("nameForm").style.display = "block";
});

function showAlertPopup(message) {
  document.getElementById("alertPopupMessage").innerText = message;
  document.getElementById("alertPopup").style.display = "flex";
}

function closeAlertPopup() {
  document.getElementById("alertPopup").style.display = "none";
}


      // 상태 초기화 후 이름 입력폼으로 돌아가기
  function resetGame() {
    // 1) 전역 상태 변수 초기화
    p1 = "";
    p2 = "";
    isFirst = true;
    index = 0;
    currentRound = 0;
    totalQuestionsAsked = 0;
    firstAnswers = [];
    secondAnswers = [];
    score = 0;
    selectedQuestions = [];

    // 2) 입력 필드 비우기
    document.getElementById("player1Name").value = "";
    document.getElementById("player2Name").value = "";

    // 3) 모든 화면 숨기기
    document.getElementById("startPrompt").style.display = "none";
    document.getElementById("questionBox").style.display = "none";
    document.getElementById("finalResult").style.display = "none";

    // 4) 이름 입력폼 보이기
    document.getElementById("nameForm").style.display = "block";
  }

    
</script>
<div id="alertPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.4); z-index: 9999; justify-content: center; align-items: center;">
<div style="background: white; padding: 24px 32px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); color: #333; max-width: 90%; text-align: center;">
<p id="alertPopupMessage" style="font-size: 18px;">알림 메시지</p>
<button onclick="closeAlertPopup()" style="margin-top: 20px; padding: 10px 20px; font-size: 16px; background-color: #88f5e1; border: none; border-radius: 8px; cursor: pointer;">확인</button>
</div>
</div>
</body>
</html>
